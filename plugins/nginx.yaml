version: 0.0.2
title: Nginx
description: Log parser for Nginx
parameters:
  enable_access_log:
    label: Access Logs
    description: Enable to collect Nginx access slogs
    type: bool
    default: true
  access_log_path: # TODO this is inherited from the nested plugin. How to manage?
    label: Access Log Path
    description: Path to access log file
    type: string
    default: "/var/log/nginx/access.log*"
  enable_error_log:
    label: Error Logs
    description: Enable to collect Nginx error logs
    type: bool
    default: true
  error_log_path: # TODO this is inherited from the nested plugin. How to manage?
    label: Error Log Path
    description: Path to error log file
    type: string
    default: "/var/log/nginx/error.log*"
  start_at:
    label: Start At
    description: Start reading file from 'beginning' or 'end'
    type: enum
    valid_values:
     - beginning
     - end
    default: end

# Set Defaults
# {{$enable_access_log := default true .enable_access_log}}
# {{$enable_error_log := default true .enable_error_log}}
# {{$start_at := default "end" .start_at}}

# Pipeline Template
pipeline:
  #{{ if $enable_access_log }}
  - type: nginx.access_file_input
    path: {{ $access_log_path }}
    start_at: {{ $start_at }}
  - type: nginx.access_parser
    output: {{ .output }}
  #{{ end }}

  #{{ if $enable_error_log }}
  - id: nginx.error_file_input
    path: {{ $error_log_path }}
    start_at: {{ $start_at }}
  - type: nginx.error_parser
    output: {{ .output }}
  #{{ end }}
